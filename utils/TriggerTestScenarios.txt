package javaSeed.utils;

import java.lang.reflect.InvocationTargetException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;

import org.testng.annotations.BeforeGroups;
import org.testng.annotations.BeforeSuite;

import javaSeed.constants.Const;
import javaSeed.driverSheet.TriggerTestSteps;

public class TriggerTestScenarios {
	
	// Consuming data from Test Scenario Sheet in to a local 2D array. Notice the data pulled was Flagged executable data
	private static String[][] arrTestScenario = Const.SHTEST_SCENARIOS;
	// Consuming HasMap of the Test Steps Sheet data in to local HashMap variable
	private static HashMap<Integer,String[]> LocMAP_TESTSTEP_ARRLIST = Const.MAP_TESTSTEP_ARRLIST;
	
	
	// ################## Method to Call Test Steps Methods (Flagged 'Y') for Each Scenario Defined in Scenario Sheet Flagged 'Y' #########################
	@SuppressWarnings("rawtypes")
	//@BeforeGroups 
	public static void TestScenariosExecution() throws ClassNotFoundException, NoSuchMethodException, SecurityException, InstantiationException, IllegalAccessException, IllegalArgumentException, InvocationTargetException{
		

		int i=0;
		// Loop Start for Each Scenario 
		for (i=0;i<arrTestScenario.length;i++){
			
			ArrayList<String[]> ArrListScenariosTestSteps = new ArrayList<String[]>(1);
			
		    ParseExcelFile oTestCaseData = new ParseExcelFile();
			String arrTestCaseData[][];
			
			int ScenarioIndexFrom=0,ScenarioIndexTo=0;
			
			// Initializing Iterator object for HashMap of Test Step ArrayList 
			Iterator it = LocMAP_TESTSTEP_ARRLIST.entrySet().iterator();
			// Loop Each Test Step Row for Scenario in primary Loop
		    while (it.hasNext()) {
		        Map.Entry pair = (Map.Entry)it.next();
		        // Putting Array from each row Array List to a temporary Array
		        String[] TestStepRow = (String[]) pair.getValue();
		        	// Compare the Scenario Name from Scenario Sheet and Test Step Sheet if True...	        
			        if (arrTestScenario[i][0].contentEquals(TestStepRow[0])){
			        	ArrListScenariosTestSteps.add(TestStepRow);
			        }
		    }
		    
		    // If Scenario in loop has Function defined then run below code
		    if (ArrListScenariosTestSteps.size()>0){
		    	
		    	// Getting Scenario Execution Index Defined on testScenarios Sheet
		    	String[] arrSceIndex = arrTestScenario[i][2].split("-");
		    	ScenarioIndexFrom = Integer.parseInt(arrSceIndex[0]);
		    	ScenarioIndexTo = Integer.parseInt(arrSceIndex[1]);
		    	
		    	// Pulling Test Case Data for the current Scenario in a 2D Array 
				arrTestCaseData = oTestCaseData.ReadExcel(Const.JAVA_SEED_DRIVERSHEET_PATH, "tc"+arrTestScenario[i][0]);
				
				// Loop for Scenario Execution Index, 'Iteration Index' column on the testScenario Sheet 
				for (int ScenItr=ScenarioIndexFrom;ScenItr<=ScenarioIndexTo;ScenItr++){
					
					// Loop Each Scenario Execution Index, Loop through each Function defined in the testSteps sheets.
				    for (int j=0;j<ArrListScenariosTestSteps.size();j++){
				    	
				    	// ###########################################################
				    	TriggerTestSteps.setArrListScenariosTestSteps(ArrListScenariosTestSteps.get(j));
				    	TriggerTestSteps.setArrTestCaseData(arrTestCaseData[ScenItr]);
				    	TriggerTestSteps.TestStepsExecution();
				    	// ###########################################################				    	
				    	//System.out.println(arrTestScenario[i][0]+" -- "+ArrListScenariosTestSteps.get(j).length+" --- "+arrTestCaseData[ScenItr].toString());
				    }
				}		    	
		    }
		}
	}
}